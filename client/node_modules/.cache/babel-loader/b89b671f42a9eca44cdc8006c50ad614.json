{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Farrukh/Documents/e-commerce/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/Farrukh/Documents/e-commerce/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/Farrukh/Documents/e-commerce/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from'react';import{CardElement,useElements,useStripe}from'@stripe/react-stripe-js';import{Card,CardActions,CardContent,Button,Typography}from'@mui/material';import PaymentSuccessFull from'./PaymentSuccessFull';import EmptyCart from'./EmptyCart';import{useDispatch,useSelector}from'react-redux';import{clearCart}from'./storeSlice';import axios from'axios';import'../styles/payment.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CARD_ELEMENT_OPTIONS={style:{base:{color:\"#495057\",fontFamily:\"inherit\",fontSmoothing:\"antialiased\",fontSize:\"16px\",\"::placeholder\":{color:\"#6c757d\"}},invalid:{color:\"#dc3545\",iconColor:\"#dc3545\"}}};function PaymentForm(){var _useSelector=useSelector(function(state){return state.store;}),totalPrice=_useSelector.totalPrice,cartItems=_useSelector.cartItems,isPaymentSuccessful=_useSelector.isPaymentSuccessful;var dispatch=useDispatch();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),success=_useState2[0],setSuccess=_useState2[1];var stripe=useStripe();var elements=useElements();function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _yield$stripe$createP,error,paymentMethod,id,response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:_context.next=5;return stripe.createPaymentMethod({type:'card',card:elements.getElement(CardElement)});case 5:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;if(!(!error&&totalPrice!==0)){_context.next=22;break;}_context.prev=9;id=paymentMethod.id;_context.next=13;return axios.post('http://localhost:8000/payment',{amount:totalPrice*100,id:id});case 13:response=_context.sent;if(response.data.success){console.log(\"Successful Payment\");dispatch(clearCart());setSuccess(true);}_context.next=20;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](9);console.log(\"Error\",_context.t0);case 20:_context.next=23;break;case 22:console.log(error.message);case 23:case\"end\":return _context.stop();}}},_callee,null,[[9,17]]);}));return _handleSubmit.apply(this,arguments);}return/*#__PURE__*/_jsx(\"div\",{children:!isPaymentSuccessful&&cartItems.length===0?/*#__PURE__*/_jsx(EmptyCart,{}):!success?/*#__PURE__*/_jsx(\"div\",{className:\"payment-div\",children:/*#__PURE__*/_jsxs(Card,{sx:{maxWidth:500},className:\"payment-card\",children:[/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{sx:{fontSize:24},color:\"text.secondary\",gutterBottom:true,children:\"Complete Payment\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(CardElement,{options:CARD_ELEMENT_OPTIONS})]}),/*#__PURE__*/_jsx(CardActions,{children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",className:\"pay-button\",onClick:function onClick(e){return handleSubmit(e);},children:\"Pay\"})})]})}):/*#__PURE__*/_jsx(PaymentSuccessFull,{})});}export default PaymentForm;","map":{"version":3,"names":["React","useState","CardElement","useElements","useStripe","Card","CardActions","CardContent","Button","Typography","PaymentSuccessFull","EmptyCart","useDispatch","useSelector","clearCart","axios","CARD_ELEMENT_OPTIONS","style","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor","PaymentForm","state","store","totalPrice","cartItems","isPaymentSuccessful","dispatch","success","setSuccess","stripe","elements","handleSubmit","e","preventDefault","createPaymentMethod","type","card","getElement","error","paymentMethod","id","post","amount","response","data","console","log","message","length","maxWidth"],"sources":["/Users/Farrukh/Documents/e-commerce/client/src/components/PaymentForm.js"],"sourcesContent":["import React, {useState} from 'react';\nimport { CardElement, useElements, useStripe } from '@stripe/react-stripe-js';\nimport { Card, CardActions, CardContent, Button, Typography} from '@mui/material';\nimport PaymentSuccessFull from './PaymentSuccessFull';\nimport EmptyCart from './EmptyCart';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { clearCart } from './storeSlice';\nimport axios from 'axios';\nimport '../styles/payment.css'\n\nconst CARD_ELEMENT_OPTIONS = {\n  style: {\n    base: {\n      color: \"#495057\",\n      fontFamily: \"inherit\",\n      fontSmoothing: \"antialiased\",\n      fontSize: \"16px\",\n      \"::placeholder\": {\n        color: \"#6c757d\",\n      },\n    },\n    invalid: {\n      color: \"#dc3545\",\n      iconColor: \"#dc3545\",\n    },\n  },\n};\n\nfunction PaymentForm() {\n  const { totalPrice, cartItems, isPaymentSuccessful } = useSelector((state) => state.store);\n  const dispatch = useDispatch();\n\n  const [success, setSuccess] = useState(false);\n  const stripe = useStripe();\n  const elements = useElements();\n\n  async function handleSubmit(e) {\n    e.preventDefault();\n    if (!stripe || !elements) {\n      return;\n    }\n\n    const {error, paymentMethod} = await stripe.createPaymentMethod({\n      type: 'card',\n      card: elements.getElement(CardElement)\n    })\n\n    if (!error && totalPrice !== 0) {\n      try {\n        const {id} = paymentMethod;\n        const response = await axios.post('http://localhost:8000/payment', {\n          amount: totalPrice*100,\n          id\n        })\n\n        if (response.data.success) {\n          console.log(\"Successful Payment\")\n          dispatch(clearCart())\n          setSuccess(true)\n        }\n\n      } catch (error) {\n        console.log(\"Error\", error)\n      }\n    } else {\n      console.log(error.message)\n    }\n  }\n\n  return (\n    <div>\n      {\n        !isPaymentSuccessful && cartItems.length === 0 ? \n        <EmptyCart /> \n        :\n          !success ?\n          <div className='payment-div'>\n            <Card \n              sx={{ maxWidth: 500 }} \n              className='payment-card'\n            >\n              <CardContent>\n                <Typography sx={{ fontSize: 24 }} color=\"text.secondary\" gutterBottom>\n                  Complete Payment\n                </Typography>\n                <br />\n                <CardElement options={CARD_ELEMENT_OPTIONS}/>\n              </CardContent>\n              <CardActions>\n                <Button \n                  variant=\"contained\" \n                  className='pay-button' \n                  onClick={(e) => handleSubmit(e)}\n                >\n                  Pay\n                </Button>\n              </CardActions>\n            </Card>\n          </div> \n          : \n          <PaymentSuccessFull />\n      }\n    </div>\n  );\n}\n\nexport default PaymentForm;"],"mappings":"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"},"metadata":{},"sourceType":"module"}